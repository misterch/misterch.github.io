---
title: 位运算
date: 2023-07-21
categories:
 - 计算机基础
tag: 
 - 位运算
---
## 原码

是最简单的机器数表示法，用最高位表示符号位，其他位存放该数的二进制的绝对值。

```js
//十进制转二进制
2 = 0010
-2 = 1010

1+2 = 0001 + 0010 = 0011
0+(-0) = 0000 + 1000 = 1000 = -0
1+(-1) = 0001 + 1001 = 1010 = -2
```

## 反码

:::tip

正数的反码和原码是一样

负数的反码是在其原码的基础上, 符号位不变，其余各个位取反

:::

```javascript
//十进制3
//二进制原码
0000 0011
//反码
0000 0011

//十进制-3
//符号位取反
1000 0011
//反码
1111 1100

```

## 补码

:::tip

**补码=反码+1**

正数的补码和原码一样

计算机以**补码储存二进制**

:::

```javascript
//3的原码，正数原反补都都一样
0000 0011
//反码
0000 0011
//补码
0000 0011
========================
//-3的真码，是拿正数3最高位设置成1,1表示负数
1000 0011 === -3 //真码

//计算机储存的是补码，-3需要转换成补码储存

//-3真码取反,除最高位，其余都反码
1111 1100 //反码

//反码+1=补码
1111 1100 + 1=1111 1101
//计算机最终储存的值是 1111 1101
===========================================
//补码转成真码
//先转成反码，即反码= 补码-1
1111 1101 - 1 = 1111 1100
//反码转真码，除最高位，其余取反
1000 0011 = -3
```

## 结论

计算机以补码储存二进制

正数原反补都相同

负数=补码=反码+1

| 十进制 | 二进制 | 原码 | 反码（除符号位，其余取反） | 补码(反码+1) |
| :----: | :----: | :--: | :------------------------: | :----------: |
| 正数2  |  0010  | 0010 |            0010            |     0010     |
| 负数2  |  1010  | 1010 |            1101            |     1110     |



## 位运算&与

二进制对应两位进行逻辑AND运算
:::tip
同为1才为1，其他都为0

与运算相当于对应位**相加之后的进位**
:::


0&0=0

0&1=0

1&1=1


### 判断奇偶

```javascript
//判断一个整数的二进制补码尾部是否【等于1】，等于1即为奇数
X & 1 === X % 2
```

### 一个整数是否是2的幂

```javascript
//如果一个数是2的幂，那么必然是1后面接若干个0
//结果等于0则是2的幂
n & (n - 1) === 0
```


## 位运算|或

二进制对应两位进行逻辑OR运算

:::tip
同为0才为0，其他都为1
:::


0|0=0

1|0=1

1|1=1
### 开关

```javascript
//有三种开关的状态，可以用2位即2bit表示
//2bit可以最多表示4中状态2^2=4
// 四种状态为：00,01,10,11
let permission = {
	read: 0b01,
	whrite: 0b10,
	create: 0b11
}
let readAndWrite = permission.read | permission.write = 3 === 0b11

```

## 位运算^异或

二进制对应两位进行逻辑XOR运算
:::tip

相同为0，不同为1

相当于位**相加**

两个相同数异或，结果为0

非0的数与0异或，结果为数字本身
:::


0^0=0

1^1=0

0^1=1

### 交换两个数的值

```javascript
let a = 20
let b = 30
//不借助临时变量，使用异或位运算
a = a^b //10->0000 1010
b = a^b //20->0001 0100
a = a^b //30->0001 1110

//使用ES6解构
[b,a] = [a,b]


//使用加减运算
a = a + b //得到两数的和
b = a - b //两数和减去b的数，现在b等于a的数
a = a - b //两数和减去b的数，现在a等于b的数
```

## 位运算~取反

二进制运算0变成1,1变成0

```javascript
//对1取相反数

//1的二进制为
1===0000 0001
//对1的二进制取反
~1 1111 1110 //这得到的是计算机储存的【补码】，要转换成【真码】才能得到十进制
//对1111 1110补码转换成反码，反码=补码-1
1111 1101
//反码转成真码（原码），符号位不变，其余取反
1000 0010
//转换成十进制是
-2
~1===-2
```
:::tip
~n=-(n+1)
:::

### 取相反数

```javascript
//对12去相反数
~12+1 === -12
```

### 小数快速取整

```javascript
//12.21545158
~12.21545158 => 取出整数部分12，12取反即~12最终结果为-13
再对-13取反
~-13 === 13-1 === 12
```

## 左移运算符<<

运算格式：被执行左移的十进制数 << 需要左移位数

:::tip 总结
被执行左移的十进制数转换成二进制，整体**左移**，在**最右边补0**

整数m左移n位，相当于2的n次方乘以m
$$
m<<n=m*(2^n)
$$
:::


如3<<4

二进制表示整数3：0011

左移4位即：0011 0000 ，转成十进制即48

十进制表示即：
$$
3 * 2 * 2 * 2 * 2 = 3 * 2^3
$$

### m*(2^n)

## 右移运算符>>

运算格式：被执行右移的十进制数 >> 需要右移位数
:::tip 总结

运算规则：被执行右移的十进制数转换成二进制，整体**右移**，在**最左边补0**

整数m右移n位，相当于m**除以**2的n次方
$$
m>>n={m \over 2^n}
$$
:::

如100>>3

二进制表示整数100：0110 0100

右移3位即：0000 1100，转换成十进制即12

十进制表示即：
$$
100 \div 2 ^ 3
$$
### m/2^n

## 无符号右移动>>>

## 位运算实现权限组合

利用位运算，每一个位可以代表一个权限，关键在于可以互相组合出新的权限组合而不用新建组合

```js
const READ   = 0b0001 //十进制1
const WRITE  = 0b0010 //十进制2
const UPDATE = 0b0100 //十进制4
const DEL    = 0b1000 //十进制8
```

### 或运算（|）==> 组合权限

或运算，同0为0，有1为1

```js
// 用户权限可读可写
const user1Permission = READ|WRITE // 0b0011
//超级用户拥有所有权限
const root = READ|WRITE|UPDATE|DEL // 0b1111
```

### 与运算（&）==> 判断是否有权限

与运算，同1为1，其他为0

```js
const user1Permission = READ|WRITE // 0b0011
user1Permission & WRITE // 2，即 0b0011 & 0b0010 => 0b0010 = 2
```

结果等于2，即等于WRITE的值，表示具有此权限

### 异或运算（^）==> 删除或新增权限

异或运算，相同为0，不同为1

```js
root ^= del // 0b1111^0b1000 = 0b0111 = 7
```

结果等于7，即(READ | WRITE | UPDATE)的组合结果