---
title: Vue中动态引入图片为什么要用require
date: 2023-09-06
categories:
 - vue
 - 面试
tags:
 - require
 - 动态引入
---

## 什么事静态资源

> 静态资源：一般是客户端发送请求到web服务器，web服务器从内存中渠道相应的文件，返回给客户端，客户端解析并渲染显示出来
>
> 动态资源：一般是客户端请求的动态资源，先将请求交给web容器，web容器连接**数据库**，数据库处理数据后，将内容交给web服务器，web服务器返回给客户端解析渲染处理

站在vue项目的角度可以这样理解：

**静态资源就是直接存放在项目中的资源**，这些资源不需要我们发送专门的请求进行获取，比如assets目录下的图片，音频，视频，CSS样式，JS文件等等

动态资源就是需要发送请求获取到的资源。

## 为什么动态添加的src会被当做静态资源

回答这个问题之前，我们需要了解一下，浏览器是怎么能运行一个vue项目的。

我们知道浏览器打开一个网页，实际上运行的是html，css，js三种类型的文件。当我们本地启动一个vue项目的时候，实际上是先将vue项目进行打包，打包的过程就是将项目中的一个个vue文件转编译成html，css，js文件的过程，而后再在浏览器上运行的。

那动态添加的src如果我们没有使用require引入，最终会打包成什么样子呢，我带大家实验一波。

```vue
// vue文件中动态引入一张图片
<template>
  <div class="home">
      <!-- 通过v-bind引入资源的方式就称之为动态添加 -->
    <img :src="'../assets/logo.png'" alt="logo">
  </div>
</template>

//最终编译的结果(浏览器上运行的结果)
//这张图片是无法被正确打开的
<img src="../assets/logo.png" alt="logo">  
```

我们可以看出，**动态添加的src最终会编译成一个静态的字符串地址。程序运行的时候，会按照这个地址去项目目录中引入资源。而去项目目录中引入资源的这种方式，就是将该资源当成了静态资源**。所以这也就回答了我们的问题2。

看到这里估计就有小伙伴疑惑了，这个最终被编译的地址有什么问题吗？我项目中的图片就是这个地址，为什么无法引入？别急，我们继续往下看。

## 没有进行编译，是指什么没有被编译

这句话其实是错的，动态引入的图片资源最终是被编译了，只是编译后无法正确引入图片资源而已，正确的答案应该是

**因为动态添加src被当做静态资源处理了，而被编译过后的静态路径无法正确引入资源，所以要使用require**

那为什么被编译过后的**静态路径**无法正确地引入资源呢？

要得到这个答案，我们可以先静态引入图片资源，这肯定能正确引入，vue文件也会被编译，主要看看打包编译后的静态引入的图片会被编译成什么样

```vue
// vue文件中静态的引入一张图片
<template>
  <div class="home">
      <!-- 直接引入图片静态地址， 不再使用v-bind -->
    <img src="../assets/logo.png" alt="logo">
  </div>
</template>

//最终编译的结果
//这张图片是可以被正确打开的
<img src="/img/logo.6c137b82.png" alt="logo">
```

从最终编译后的代码来看，静态引入的资源的**路径和名称都发生了改变**，并且可以成功引入资源。原因是，src目录下面的所有文件都会被打包，src下面的图片等静态资源也会被打包在新的文件夹下并生成新的文件名，**编译过后的静态资源地址引入的是打包后的图片地址**，从而可以正确的引入资源

![](https://mmbiz.qpic.cn/mmbiz/mshqAkialV7FR66u2vicp9oqzhopEkiaBASxLpqEPETmVedRYozICmEPCQcEujKUTH60vFEo6cooEGI0jKEibatYXA/640?wx_fmt=jpeg&tp=wxpic&wxfrom=5&wx_lazy=1&wx_co=1)

可以发现，编译过后的静态地址确实是和dist下编译后图片地址是一致的

这样就可以解析动态添加的src，被编译后的静态路径无法正确引入资源的问题

**因为动态添加src编译后的地址，与图片资源编译过后的资源地址不一致，导致无法正确引入资源**

```
 动态添加编译过后的src地址：../assets/logo.png
 静态添加编译过后的src地址：/img/logo.6c137b82.png
 
 编译过后的图片资源地址：/img/logo.6c137b82.png
```



## 加上require为什么能正确引入资源

无论加不加`require`，vue文件中引入的资源都会被编译

`require`是node的方法，用于引入模块，JSON或本地文件

vue2是通过`webpack`打包的，使用`require`引入的资源就是一个模块，那么`webpack`就会根据配置文件中的规则进行打包。**我们可以将require当成一个桥梁，使用`require`方法引入资源，该资源就会被当成模块并根据配置文件进行打包，并得到最终的打包结果**

Q：调用`require`方法引入一张图片之后发生了什么？

A：

1. 如果图片小于`webpack`配置中的资源限制大小，则会返回图片的`base64`插入到`require`方法的调用处

2. 如果图片大于`webpack`配置中的资源限制大小，则会将这个图片编译成一个新的图片资源，`require`方法返回新的图片路径和文件名

Q：为什么加上`require`能正确的引入资源

A：因为`require`方法拿到的文件地址，是资源文件编译过后的文件地址（即打包后dist目录下生成的文件），而不是我们在开发时资源的路径

```vue
// vue文件中使用require动态的引入一张图片
<template>
  <div class="home">
      <!-- 使用require动态引入图片 -->
      <img :src="require('../assets/logo.png')" alt="logo">
  </div>
</template>

//最终编译的结果
//这张图片是可以被正确打开的
<img src="/img/logo.6c137b82.png" alt="logo">
```

**因为动态添加的src，编译过后的文件地址和被编译过后的资源文件地址不一致，从而无法正确引入资源。而使用require，返回的就是资源文件被编译后的文件地址，从而可以正确的引入资源**

### 为什么静态引入不使用require也能返回编译过后的资源地址呢

因为`webpack`编译vue文件时，**遇见src等属性会默认地使用require引入资源**，vue-cli的官方解析是这样的

> 当你在 JavaScript、CSS 或 `*.vue` 文件中使用相对路径 (必须以 `.` 开头) 引用一个静态资源时，该资源将会被包含进入 webpack 的依赖图中。在其编译过程中，所有诸如 `<img src="...">`、`background: url(...)` 和 CSS `@import` 的资源 URL **都会被解析为一个模块依赖**。
>
> 例如，`url(./image.png)` 会被翻译为 `require('./image.png')`，而：
>
> ```vue
> <img src="./image.png">
> ```
>
> 将会被编译到：
>
> ```js
> h('img', { attrs: { src: require('./image.png') }})
> ```

### 为什么动态引入的资源不能正确返回编译后的资源地址呢

因为动态引入资源时，src后面的属性值，实际上是一个**变量**，webpack会根据v-bind指令去解析src后面的属性值，并**不会通过require引入资源**，这就需要使用require来正确引入了

## public目录下面的文件不会被编译，如何使用

官方解释

> 任何放置在 `public` 文件夹的静态资源都会被简单的复制，而不经过 webpack。你需要通过**绝对路径**来引用它们。

静态引入public下的资源时，因为public目录不会经过webpack编译，也就不会使用到require，需要使用绝对路径静态引用

打包时默认会将`public`文件夹里的资源打包到dist的根目录下，使用public下的资源时使用绝对路径引入如`/logo.png`



## 总结

1. 静态资源是请求项目中的资源文件，无需发请求就可获取；动态资源需要发送请求到服务器获取资源返回给前端
2. 使用相对路径静态引入的静态资源在编译过程中会被webpack当做一个模块依赖，编译成使用require这个相对路径来引入静态资源
3. 动态添加的静态资源，是一个变量，使用v-bind指令解析属性值，不会使用require引入资源。需要使用require方法才能正确引入
4. 无论静态添加还是动态添加，都会被编译，只是动态添加不使用require会编译一个错误的资源地址
5. public下的资源不会被编译，只是复制到打包后的根目录下，需要使用绝对路径静态引用

## 参考链接

[vue中动态引入图片为什么要是require， 你不知道的那些事 - 掘金 (juejin.cn)](https://juejin.cn/post/7159921545144434718)